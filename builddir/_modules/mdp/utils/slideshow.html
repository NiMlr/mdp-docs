

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mdp.utils.slideshow &mdash; Modular toolkit for Data Processing (MDP)</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Modular toolkit for Data Processing (MDP)" href="../../../index.html"/>
        <link rel="up" title="mdp.utils" href="../utils.html"/> 
<meta name="viewport" content="width=740" />


  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html">
          

          
            
            <img src="../../../_static/logo_animation.gif" class="logo" />
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../how_to_cite_mdp.html">How to cite MDP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contact.html">Contact</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">MDP</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../mdp.html">mdp</a> &raquo;</li>
        
          <li><a href="../utils.html">mdp.utils</a> &raquo;</li>
        
      <li>mdp.utils.slideshow</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for mdp.utils.slideshow</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module for HTML slideshows.</span>

<span class="sd">It uses the templating library &#39;Templet&#39;.</span>

<span class="sd">The slideshow base class HTMLSlideShow does not display anything, but can</span>
<span class="sd">be used to derive custom slideshows like in BiMDP.</span>

<span class="sd">The JavaScript slideshow code in this module was originally inspired by a</span>
<span class="sd">slideshow script found at</span>
<span class="sd">http://javascript.internet.com/miscellaneous/image-slideshow.html</span>
<span class="sd">(which in turn seems to be based on something from http://www.ricocheting.com)</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">builtins</span> <span class="k">import</span> <span class="nb">str</span>

<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">webbrowser</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">templet</span>

<span class="n">_BASIC_CSS_FILENAME</span> <span class="o">=</span> <span class="s2">&quot;basic.css&quot;</span>
<span class="n">_SLIDESHOW_CSS_FILENAME</span> <span class="o">=</span> <span class="s2">&quot;slideshow.css&quot;</span>

<span class="k">def</span> <span class="nf">basic_css</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Return the basic default CSS.&quot;&quot;&quot;</span>
    <span class="n">css_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">_BASIC_CSS_FILENAME</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">css_filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">css_file</span><span class="p">:</span>
        <span class="n">css</span> <span class="o">=</span> <span class="n">css_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">css</span>

<span class="k">def</span> <span class="nf">slideshow_css</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Return the additional CSS for a slideshow.&quot;&quot;&quot;</span>
    <span class="n">css_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">_SLIDESHOW_CSS_FILENAME</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">css_filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">css_file</span><span class="p">:</span>
        <span class="n">css</span> <span class="o">=</span> <span class="n">css_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">css</span>


<span class="k">class</span> <span class="nc">HTMLSlideShow</span><span class="p">(</span><span class="n">templet</span><span class="o">.</span><span class="n">Template</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Abstract slideshow base class.</span>

<span class="sd">    It does not display anything, but can be adapted by overriding</span>
<span class="sd">    some of the templating attributes. See ImageHTMLSlideShow for an example.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">delay_delta</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                 <span class="n">loop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">slideshow_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shortcuts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the complete HTML code for the slideshow.</span>

<span class="sd">        title -- Optional slideshow title (for defualt None not title is shown).</span>
<span class="sd">        delay - Delay between slides in ms (default 100).</span>
<span class="sd">        delay_delta - Step size for increasing or decreasing the delay.</span>
<span class="sd">        loop -- If True continue with first slide when the last slide is</span>
<span class="sd">            reached during the automatic slideshow (default is False).</span>
<span class="sd">        slideshow_id -- String with the id used for the JS closure, and this</span>
<span class="sd">            is also the id of the div with the slideshow (so it can be used</span>
<span class="sd">            by CSS) and it is used as a prefix for the HTML elements.</span>
<span class="sd">            If the value is None (default) then a random id is used.</span>
<span class="sd">        shortcuts -- Bind keyboard shortcuts to this slideshow (default is</span>
<span class="sd">            True). Note that keyboard shortcuts only work for a single</span>
<span class="sd">            slideshow per page.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># translate boolean variable into JS format</span>
        <span class="k">if</span> <span class="n">loop</span><span class="p">:</span>
            <span class="n">loop</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">loop</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
        <span class="k">if</span> <span class="n">slideshow_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">slideshow_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_random_id</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slideshow_id</span> <span class="o">=</span> <span class="n">slideshow_id</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">vars</span><span class="p">())</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;self&quot;</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">HTMLSlideShow</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="HTMLSlideShow._get_random_id"><a class="viewcode-back" href="../../../mdp/mdp.utils.html#mdp.utils.HTMLSlideShow._get_random_id">[docs]</a>    <span class="k">def</span> <span class="nf">_get_random_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Factory method for random slideshow id.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;slideshow</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">99999</span><span class="p">)</span></div>


    <span class="n">template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;script language=&quot;JavaScript&quot;&gt;</span>
<span class="s1">&lt;!-- Begin</span>

<span class="s1">// use closure to create object, the slideshow_id is the only global variable</span>
<span class="s1">var $slideshow_id = function () {</span>

<span class="s1">    var that = </span><span class="si">{}</span><span class="s1">;</span>

<span class="s1">    var current_slide = 0; // current slide index</span>
<span class="s1">    var show_delay = $delay; // delay in milliseconds</span>
<span class="s1">    var loop_slideshow = $loop; // loop in auto mode</span>
<span class="s1">    // shortcuts to form elements, initialized in onLoad</span>
<span class="s1">    var slideform;</span>
<span class="s1">    var slideselect;</span>

<span class="s1">    $&lt;js_controls_template&gt;</span>
<span class="s1">    $&lt;js_loadslide_template&gt;</span>
<span class="s1">    $&lt;js_update_template&gt;</span>
<span class="s1">    $&lt;js_onload_template&gt;</span>

<span class="s1">    that.onSelectorChange = function () {</span>
<span class="s1">        current_slide = slideselect.selectedIndex;</span>
<span class="s1">        that.updateSlide();</span>
<span class="s1">    }</span>

<span class="s1">    that.next = function () {</span>
<span class="s1">        if (slideselect[current_slide+1]) {</span>
<span class="s1">            current_slide += 1;</span>
<span class="s1">            that.updateSlide();</span>
<span class="s1">        }</span>
<span class="s1">        else if (loop_slideshow) {</span>
<span class="s1">            that.first();</span>
<span class="s1">        }</span>
<span class="s1">    }</span>

<span class="s1">    that.previous = function () {</span>
<span class="s1">        if (current_slide-1 &gt;= 0) {</span>
<span class="s1">            current_slide -= 1;</span>
<span class="s1">            that.updateSlide();</span>
<span class="s1">        }</span>
<span class="s1">        else if (loop_slideshow) {</span>
<span class="s1">            that.last();</span>
<span class="s1">        }</span>
<span class="s1">    }</span>

<span class="s1">    that.first = function () {</span>
<span class="s1">        current_slide = 0;</span>
<span class="s1">        that.updateSlide();</span>
<span class="s1">    }</span>

<span class="s1">    that.last = function () {</span>
<span class="s1">        current_slide = slideselect.length-1;</span>
<span class="s1">        that.updateSlide();</span>
<span class="s1">    }</span>

<span class="s1">    // start or stop the slideshow</span>
<span class="s1">    that.startstop = function (text) {</span>
<span class="s1">        if (text === &quot;Start&quot;) {</span>
<span class="s1">            slideform.startbutton.value = &quot;Stop&quot;;</span>
<span class="s1">            if (!loop_slideshow &amp;&amp;</span>
<span class="s1">                (current_slide === slideselect.length-1)) {</span>
<span class="s1">                // restart slideshow</span>
<span class="s1">                current_slide = -1;  // is directly increased by showAuto</span>
<span class="s1">            }</span>
<span class="s1">            that.showAuto();</span>
<span class="s1">        } else {</span>
<span class="s1">            slideform.startbutton.value = &quot;Start&quot;;</span>
<span class="s1">        }</span>
<span class="s1">    }</span>

<span class="s1">    // continuously show the slideshow</span>
<span class="s1">    that.showAuto = function () {</span>
<span class="s1">        if (slideform.startbutton.value == &quot;Stop&quot;) {</span>
<span class="s1">            if (current_slide == slideselect.length-1) {</span>
<span class="s1">                if (loop_slideshow) {</span>
<span class="s1">                    current_slide = 0;</span>
<span class="s1">                    that.updateSlide();</span>
<span class="s1">                } else {</span>
<span class="s1">                    slideform.startbutton.value = &quot;Start&quot;;</span>
<span class="s1">                }</span>
<span class="s1">            } else {</span>
<span class="s1">                current_slide = current_slide+1;</span>
<span class="s1">                that.updateSlide();</span>
<span class="s1">            }</span>
<span class="s1">            window.setTimeout(&quot;$slideshow_id.showAuto()&quot;, show_delay);</span>
<span class="s1">        }</span>
<span class="s1">    }</span>

<span class="s1">    // end of closure, return created object</span>
<span class="s1">    return that;</span>
<span class="s1">}();</span>

<span class="s1">${{</span>
<span class="s1">if shortcuts:</span>
<span class="s1">    self.js_keyboard_shortcuts_template(vars())</span>
<span class="s1">}}</span>

<span class="s1">//  End --&gt;</span>
<span class="s1">&lt;/script&gt;</span>

<span class="s1">&lt;div class=&quot;slideshow&quot; id=&quot;$slideshow_id&quot;&gt;</span>

<span class="s1">$&lt;html_top_template&gt;</span>

<span class="s1">&lt;form name=$</span><span class="si">{slideshow_id}</span><span class="s1">_slideform&gt;</span>
<span class="s1">&lt;table class=&quot;slideshow&quot;&gt;</span>
<span class="s1">${{</span>
<span class="s1">if title:</span>
<span class="s1">    self.write(&#39;&lt;tr&gt;&lt;td&gt;&lt;b&gt; </span><span class="si">%s</span><span class="s1"> &lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;&#39; % title)</span>
<span class="s1">}}</span>

<span class="s1">$&lt;html_box_template&gt;</span>

<span class="s1">&lt;tr&gt;&lt;td&gt;</span>
<span class="s1">&lt;select name=&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_slideselect&quot;</span>
<span class="s1">    onChange=&quot;$slideshow_id.onSelectorChange();&quot;&gt;</span>
<span class="s1">&lt;option value=&quot;$</span><span class="si">{filenames[0]}</span><span class="s1">&quot; selected&gt;$</span><span class="si">{filenames[0]}</span><span class="s1"></span>
<span class="s1">${{</span>
<span class="s1">for filename in filenames[1:]:</span>
<span class="s1">    self.write(&#39;&lt;option value=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="si">%s</span><span class="s1">\n&#39; % (filename, filename))</span>
<span class="s1">}}</span>
<span class="s1">&lt;/select&gt;</span>
<span class="s1">&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s1">&lt;tr&gt;&lt;td&gt;</span>

<span class="s1">$&lt;html_buttons_template&gt;</span>

<span class="s1">&lt;/td&gt;&lt;/tr&gt;</span>

<span class="s1">$&lt;html_controls_template&gt;</span>

<span class="s1">&lt;/table&gt;</span>
<span class="s1">&lt;/form&gt;</span>

<span class="s1">$&lt;html_bottom_template&gt;</span>

<span class="s1">&lt;/div&gt;</span>

<span class="s1">&lt;SCRIPT LANGUAGE=&quot;JavaScript&quot;&gt;</span>
<span class="s1">&lt;!-- Begin</span>
<span class="s1">$slideshow_id.onLoad();</span>
<span class="s1">//  End --&gt;</span>
<span class="s1">&lt;/script&gt;</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="n">js_controls_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    // step size for in- or decreasing the delay</span>
<span class="s1">    var delay_delta = $delay_delta;</span>

<span class="s1">    that.slower = function () {</span>
<span class="s1">        show_delay += delay_delta;</span>
<span class="s1">        slideform.$</span><span class="si">{slideshow_id}</span><span class="s1">_delaytext.value = show_delay.toString();</span>
<span class="s1">    }</span>

<span class="s1">    that.faster = function (text) {</span>
<span class="s1">        show_delay -= delay_delta;</span>
<span class="s1">        if (show_delay &lt; 0) {</span>
<span class="s1">            show_delay = 0;</span>
<span class="s1">        }</span>
<span class="s1">        slideform.$</span><span class="si">{slideshow_id}</span><span class="s1">_delaytext.value = show_delay.toString();</span>
<span class="s1">    }</span>

<span class="s1">    that.changeDelay = function () {</span>
<span class="s1">        var new_delay = parseInt(slideform.$</span><span class="si">{slideshow_id}</span><span class="s1">_delaytext.value, 10);</span>
<span class="s1">        if (new_delay &lt; 0) {</span>
<span class="s1">             new_delay = 0;</span>
<span class="s1">            }</span>
<span class="s1">        show_delay = new_delay;</span>
<span class="s1">        slideform.$</span><span class="si">{slideshow_id}</span><span class="s1">_delaytext.value = new_delay.toString();</span>
<span class="s1">    }</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="n">js_update_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    that.updateSlide = function () {</span>
<span class="s1">        slideselect.selectedIndex = current_slide;</span>
<span class="s1">        that.loadSlide();</span>
<span class="s1">    }</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="c1"># overwrite this to implement the actual slide change</span>
    <span class="n">js_loadslide_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    that.loadSlide = function () {</span>
<span class="s1">    }</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="n">js_onload_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    that.onLoad = function () {</span>
<span class="s1">        slideform = document.$</span><span class="si">{slideshow_id}</span><span class="s1">_slideform;</span>
<span class="s1">        slideselect = slideform.$</span><span class="si">{slideshow_id}</span><span class="s1">_slideselect;</span>
<span class="s1">        current_slide = slideselect.selectedIndex;</span>
<span class="s1">        that.updateSlide();</span>
<span class="s1">        slideform.$</span><span class="si">{slideshow_id}</span><span class="s1">_delaytext.value = show_delay.toString();</span>
<span class="s1">    }</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="c1"># define keyboard shortcuts,</span>
    <span class="c1"># note that these are also mentionend in the button hover-text</span>
    <span class="n">js_keyboard_shortcuts_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">document.onkeydown = function(e) {</span>
<span class="s1">    if (!e.ctrlKey) {  // control key must be pressed</span>
<span class="s1">        return;</span>
<span class="s1">    }</span>
<span class="s1">    else if (e.which == 37) { // left key</span>
<span class="s1">        document.getElementById(&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_prevButton&quot;).click();</span>
<span class="s1">    }</span>
<span class="s1">    else if(e.which == 39) { // right key</span>
<span class="s1">        document.getElementById(&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_nextButton&quot;).click();</span>
<span class="s1">    }</span>
<span class="s1">    else if(e.which == 38) { // up key</span>
<span class="s1">        document.getElementById(&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_firstButton&quot;).click();</span>
<span class="s1">    }</span>
<span class="s1">    else if(e.which == 40) { // down key</span>
<span class="s1">        document.getElementById(&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_lastButton&quot;).click();</span>
<span class="s1">    }</span>
<span class="s1">    else if(e.which == 45) { // insert key</span>
<span class="s1">        document.getElementById(&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_startButton&quot;).click();</span>
<span class="s1">    }</span>
<span class="s1">}</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="n">html_buttons_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;input type=button onClick=&quot;$slideshow_id.first();&quot;</span>
<span class="s1">    value=&quot;|&lt;&lt;&quot; title=&quot;First&quot; id=&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_firstButton&quot;&gt;</span>
<span class="s1">&lt;input type=button onClick=&quot;$slideshow_id.previous();&quot;</span>
<span class="s1">    value=&quot;&lt;&quot; title=&quot;Previous (Ctrl+Left)&quot; id=&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_prevButton&quot;&gt;</span>
<span class="s1">&lt;input type=button name=&quot;startbutton&quot;</span>
<span class="s1">    onClick=&quot;$slideshow_id.startstop(this.value);&quot;</span>
<span class="s1">    value=&quot;Start&quot; title=&quot;Autoplay (Ctrl+Insert)&quot;</span>
<span class="s1">    id=&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_startButton&quot;&gt;</span>
<span class="s1">&lt;input type=button onClick=&quot;$slideshow_id.next();&quot; value=&quot;&gt;&quot;</span>
<span class="s1">    title=&quot;Next (Ctrl+Right)&quot;</span>
<span class="s1">    id=&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_nextButton&quot;&gt;</span>
<span class="s1">&lt;input type=button onClick=&quot;$slideshow_id.last();&quot; value=&quot;&gt;&gt;|&quot; title=&quot;Last&quot;</span>
<span class="s1">    id=&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_lastButton&quot;&gt;</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="n">html_controls_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">${{</span>
<span class="s1">if delay is not None:</span>
<span class="s1">    self.write(&#39;&lt;tr&gt;&lt;td&gt;\n&#39;)</span>
<span class="s1">    self.html_delay_template(vars())</span>
<span class="s1">    self.write(&#39;&lt;/td&gt;&lt;/tr&gt;\n&#39;)</span>
<span class="s1">}}</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="n">html_delay_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">delay: &lt;input type=&quot;text&quot; name=&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_delaytext&quot;</span>
<span class="s1">    onChange=&quot;$slideshow_id.changeDelay();&quot; value=&quot;0&quot; size=&quot;4&quot;&gt; ms</span>
<span class="s1">&lt;input type=button onClick=&quot;$slideshow_id.faster();&quot; value=&quot;-&quot; title=&quot;Faster&quot;&gt;</span>
<span class="s1">&lt;input type=button onClick=&quot;$slideshow_id.slower();&quot; value=&quot;+&quot; title=&quot;Slower&quot;&gt;</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="n">html_top_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="n">html_box_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="n">html_bottom_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&#39;&#39;&#39;</span>


<span class="k">class</span> <span class="nc">SectionHTMLSlideShow</span><span class="p">(</span><span class="n">HTMLSlideShow</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Astract slideshow with additional support for section markers.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section_ids</span><span class="p">,</span> <span class="n">slideshow_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the complete HTML code for the slideshow.</span>

<span class="sd">        section_ids -- List with the section id for each slide index. The id</span>
<span class="sd">            can be a string or a number.</span>

<span class="sd">        For additional keyword arguments see the super class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we need the slideshow_id for the section names</span>
        <span class="k">if</span> <span class="n">slideshow_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">slideshow_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_random_id</span><span class="p">()</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">vars</span><span class="p">())</span>
        <span class="c1"># check if there is more than one section slideshow_id,</span>
        <span class="c1"># otherwise some controls must be disabled to prevent infinite loop</span>
        <span class="n">only_one_section</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
        <span class="n">first_section_id</span> <span class="o">=</span> <span class="n">section_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">section_id</span> <span class="ow">in</span> <span class="n">section_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">section_id</span> <span class="o">!=</span> <span class="n">first_section_id</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">only_one_section</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;only_one_section&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">only_one_section</span>
        <span class="c1"># translate section_id_list into JavaScript list</span>
        <span class="n">section_ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">section_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">section_id</span> <span class="ow">in</span> <span class="n">section_ids</span><span class="p">]</span>
        <span class="n">js_section_ids</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;        &quot;</span><span class="si">%s</span><span class="s1">_section_id_</span><span class="si">%s</span><span class="s1">&quot;,</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                                  <span class="p">(</span><span class="n">slideshow_id</span><span class="p">,</span> <span class="n">section_id</span><span class="p">)</span>
                                  <span class="k">for</span> <span class="n">section_id</span> <span class="ow">in</span> <span class="n">section_ids</span><span class="p">])</span>
        <span class="n">js_section_ids</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">js_section_ids</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;js_section_ids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">js_section_ids</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;self&quot;</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SectionHTMLSlideShow</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


    <span class="n">js_update_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    // maps slide index to section slideshow_id</span>
<span class="s1">    var section_ids = new Array($js_section_ids);</span>
<span class="s1">    // currently highlighted section slideshow_id</span>
<span class="s1">    var current_section_id = section_ids[0];</span>

<span class="s1">    that.updateSlide = function () {</span>
<span class="s1">        document.getElementById(current_section_id).className =</span>
<span class="s1">            &quot;inactive_section&quot;;</span>
<span class="s1">        current_section_id = section_ids[current_slide]</span>
<span class="s1">        document.getElementById(current_section_id).className =</span>
<span class="s1">            &quot;active_section&quot;;</span>
<span class="s1">        slideselect.selectedIndex = current_slide;</span>
<span class="s1">        that.loadSlide();</span>
<span class="s1">    }</span>

<span class="s1">    // use this function when a section is selected,</span>
<span class="s1">    // e.g. onClick=&quot;setSlide(42)&quot;</span>
<span class="s1">    that.setSlide = function (index) {</span>
<span class="s1">        current_slide = index;</span>
<span class="s1">        that.updateSlide();</span>
<span class="s1">    }</span>

<span class="s1">    that.previousSection = function () {</span>
<span class="s1">        if ($only_one_section) {</span>
<span class="s1">            return;</span>
<span class="s1">        }</span>
<span class="s1">        while (current_section_id === section_ids[current_slide]) {</span>
<span class="s1">            if (current_slide &gt; 0) {</span>
<span class="s1">                current_slide -= 1;</span>
<span class="s1">            } else {</span>
<span class="s1">                current_slide = slideselect.length-1;</span>
<span class="s1">            }</span>
<span class="s1">        }</span>
<span class="s1">        var new_section_id = section_ids[current_slide];</span>
<span class="s1">        // now go to start of this section</span>
<span class="s1">        while (new_section_id === section_ids[current_slide]) {</span>
<span class="s1">            current_slide -= 1;</span>
<span class="s1">            if (current_slide &lt; 0) {</span>
<span class="s1">                break;</span>
<span class="s1">            }</span>
<span class="s1">        }</span>
<span class="s1">        current_slide += 1;</span>
<span class="s1">        that.updateSlide();</span>
<span class="s1">    }</span>

<span class="s1">    that.nextSection = function () {</span>
<span class="s1">        if ($only_one_section) {</span>
<span class="s1">            return;</span>
<span class="s1">        }</span>
<span class="s1">        while (current_section_id === section_ids[current_slide]) {</span>
<span class="s1">            if (current_slide+1 &lt; slideselect.length) {</span>
<span class="s1">                current_slide += 1;</span>
<span class="s1">            } else {</span>
<span class="s1">                current_slide = 0;</span>
<span class="s1">            }</span>
<span class="s1">        }</span>
<span class="s1">        that.updateSlide();</span>
<span class="s1">    }</span>

<span class="s1">    $&lt;js_loadslide_template&gt;</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="c1"># define keyboard shortcuts,</span>
    <span class="c1"># note that these are also mentionend in the button hover-text</span>
    <span class="n">js_keyboard_shortcuts_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">document.onkeydown = function(e) {</span>
<span class="s1">    if (!e.ctrlKey) { // control key must be pressed</span>
<span class="s1">        return;</span>
<span class="s1">    }</span>
<span class="s1">    else if (e.which === 37) { // left key</span>
<span class="s1">        document.getElementById(&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_prevButton&quot;).click();</span>
<span class="s1">    }</span>
<span class="s1">    else if(e.which === 39) { // right key</span>
<span class="s1">        document.getElementById(&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_nextButton&quot;).click();</span>
<span class="s1">    }</span>
<span class="s1">    else if(e.which === 38) { // up key</span>
<span class="s1">        document.getElementById(&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_prevSectionButton&quot;).click();</span>
<span class="s1">    }</span>
<span class="s1">    else if(e.which === 40) { // down key</span>
<span class="s1">        document.getElementById(&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_nextSectionButton&quot;).click();</span>
<span class="s1">    }</span>
<span class="s1">    else if(e.which === 45) { // insert key</span>
<span class="s1">        document.getElementById(&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_startButton&quot;).click();</span>
<span class="s1">    }</span>
<span class="s1">}</span>
<span class="s1">    &#39;&#39;&#39;</span>

    <span class="n">html_buttons_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;input type=button onClick=&quot;$slideshow_id.first();&quot;</span>
<span class="s1">    value=&quot;|&lt;&lt;&quot; title=&quot;First&quot; id=&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_firstButton&quot;&gt;</span>
<span class="s1">&lt;input type=button onClick=&quot;$slideshow_id.previousSection();&quot; value=&quot;|&lt;&quot;</span>
<span class="s1">    title=&quot;Previous Section (Ctrl+Up)&quot; id=&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_prevSectionButton&quot;&gt;</span>
<span class="s1">&lt;input type=button onClick=&quot;$slideshow_id.previous();&quot;</span>
<span class="s1">    value=&quot;&lt;&quot; title=&quot;Previous (Ctrl+Left)&quot; id=&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_prevButton&quot;&gt;</span>
<span class="s1">&lt;input type=button name=&quot;startbutton&quot;</span>
<span class="s1">    onClick=&quot;$slideshow_id.startstop(this.value);&quot;</span>
<span class="s1">    value=&quot;Start&quot; title=&quot;Autoplay (Ctrl+Insert)&quot;</span>
<span class="s1">    id=&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_startButton&quot;&gt;</span>
<span class="s1">&lt;input type=button onClick=&quot;$slideshow_id.next();&quot; value=&quot;&gt;&quot;</span>
<span class="s1">    title=&quot;Next (Ctrl+Right)&quot;</span>
<span class="s1">    id=&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_nextButton&quot;&gt;</span>
<span class="s1">&lt;input type=button onClick=&quot;$slideshow_id.nextSection();&quot; value=&quot;&gt;|&quot;</span>
<span class="s1">    title=&quot;Next Section (Ctrl+Down)&quot; id=&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_nextSectionButton&quot;&gt;</span>
<span class="s1">&lt;input type=button onClick=&quot;$slideshow_id.last();&quot; value=&quot;&gt;&gt;|&quot; title=&quot;Last&quot;</span>
<span class="s1">    id=&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_lastButton&quot;&gt;</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="n">html_controls_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">${{super(SectionHTMLSlideShow, self).html_controls_template(vars())}}</span>

<span class="s1">&lt;tr&gt;&lt;td&gt;</span>
<span class="s1">&lt;div id=&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_sections_panel&quot;</span>
<span class="s1">    style=&quot;margin-left:auto; margin-right: auto;&quot;&gt;</span>
<span class="s1">${{</span>
<span class="s1">last_section_id = None</span>
<span class="s1">link = &#39;&#39;</span>
<span class="s1">for index, section_id in enumerate(section_ids):</span>
<span class="s1">    if section_id != last_section_id:</span>
<span class="s1">        if index &gt; 0:</span>
<span class="s1">            self.write(link + &#39;&amp;nbsp;| &#39;)</span>
<span class="s1">        last_section_id = section_id</span>
<span class="s1">        link = (&#39;&lt;span class=&quot;inactive_section&quot; &#39; +</span>
<span class="s1">                &#39;id=&quot;</span><span class="si">%s</span><span class="s1">_section_id_</span><span class="si">%s</span><span class="s1">&quot; &#39; % (slideshow_id, section_id) +</span>
<span class="s1">                &#39;onClick=&quot;</span><span class="si">%s</span><span class="s1">.setSlide(</span><span class="si">%d</span><span class="s1">);&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/span&gt;&#39; %</span>
<span class="s1">                    (slideshow_id, index, section_id))</span>
<span class="s1">self.write(link + &#39;\n&#39;)</span>
<span class="s1">}}</span>
<span class="s1">&lt;/div&gt;</span>
<span class="s1">&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s1">&#39;&#39;&#39;</span>


<span class="k">def</span> <span class="nf">image_slideshow_css</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Use nearest neighbour resampling in Firefox 3.6+ and IE.</span>

<span class="sd">    Webkit (Chrome, Safari) does not support this yet.</span>
<span class="sd">    (see http://code.google.com/p/chromium/issues/detail?id=1502)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">slideshow_css</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">img.slideshow {</span>
<span class="s1">    image-rendering: -moz-crisp-edges;</span>
<span class="s1">    -ms-interpolation-mode: nearest-neighbor;</span>
<span class="s1">}</span>
<span class="s1">&#39;&#39;&#39;</span>


<span class="k">class</span> <span class="nc">ImageHTMLSlideShow</span><span class="p">(</span><span class="n">HTMLSlideShow</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Slideshow for images.</span>

<span class="sd">    This also serves as an example for implementing a slideshow based on</span>
<span class="sd">    HTMLSlideShow.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filenames</span><span class="p">,</span> <span class="n">image_size</span><span class="p">,</span>
                 <span class="n">magnification</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mag_control</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the complete HTML code for a slideshow of the given images.</span>

<span class="sd">        filenames -- sequence of strings, containing the path for each image</span>
<span class="sd">        image_size -- Tuple (x,y) with the original image size, or enter</span>
<span class="sd">            a different size to force scaling.</span>
<span class="sd">        magnification -- Magnification factor for images (default 1). This</span>
<span class="sd">            factor is applied on top of the provided image size.</span>
<span class="sd">        mag_control -- Set to True (default) to display a magnification control</span>
<span class="sd">            element.</span>

<span class="sd">        For additional keyword arguments see the super class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Empty list was given.&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">vars</span><span class="p">())</span>
        <span class="c1"># translate image size to width and heigh to be used in the templates</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;image_size&quot;</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;self&quot;</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ImageHTMLSlideShow</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">js_controls_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    ${{super(ImageHTMLSlideShow, self).js_controls_template(vars())}}</span>

<span class="s1">    var magnification = $magnification; // image magnification</span>
<span class="s1">    var original_width = $width; // original image width</span>
<span class="s1">    var original_height = $height; // original image height</span>

<span class="s1">    that.smaller = function () {</span>
<span class="s1">        magnification = magnification / 2;</span>
<span class="s1">        slideform.$</span><span class="si">{slideshow_id}</span><span class="s1">_magtext.value = magnification.toString();</span>
<span class="s1">        that.resizeImage();</span>
<span class="s1">    }</span>

<span class="s1">    that.larger = function (text) {</span>
<span class="s1">        magnification = magnification * 2;</span>
<span class="s1">        slideform.$</span><span class="si">{slideshow_id}</span><span class="s1">_magtext.value = magnification.toString();</span>
<span class="s1">        that.resizeImage();</span>
<span class="s1">    }</span>

<span class="s1">    that.changeMag = function () {</span>
<span class="s1">        magnification = parseFloat(slideform.$</span><span class="si">{slideshow_id}</span><span class="s1">_magtext.value);</span>
<span class="s1">        that.resizeImage();</span>
<span class="s1">    }</span>

<span class="s1">    $&lt;js_controls_resize_template&gt;</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="n">js_controls_resize_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    that.resizeImage = function () {</span>
<span class="s1">        document.images.$</span><span class="si">{slideshow_id}</span><span class="s1">_image_display.width =</span>
<span class="s1">            parseInt(magnification * original_width, 10);</span>
<span class="s1">        document.images.$</span><span class="si">{slideshow_id}</span><span class="s1">_image_display.height =</span>
<span class="s1">            parseInt(magnification * original_height, 10);</span>
<span class="s1">    }</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="n">js_loadslide_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    that.loadSlide = function () {</span>
<span class="s1">        document.images.$</span><span class="si">{slideshow_id}</span><span class="s1">_image_display.src =</span>
<span class="s1">            slideselect[current_slide].value;</span>
<span class="s1">    }</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="n">js_onload_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    that.onLoad = function () {</span>
<span class="s1">        slideform = document.$</span><span class="si">{slideshow_id}</span><span class="s1">_slideform;</span>
<span class="s1">        slideselect = slideform.$</span><span class="si">{slideshow_id}</span><span class="s1">_slideselect;</span>
<span class="s1">        current_slide = slideselect.selectedIndex;</span>
<span class="s1">        that.updateSlide();</span>
<span class="s1">        ${{</span>
<span class="s1">        if delay is not None:</span>
<span class="s1">            self.write(&#39;slideform.</span><span class="si">%s</span><span class="s1">_delaytext.value = &#39; </span><span class="si">% s</span><span class="s1">lideshow_id +</span>
<span class="s1">                       &#39;show_delay.toString();\n&#39;)</span>
<span class="s1">        }}</span>
<span class="s1">        ${{</span>
<span class="s1">        if mag_control:</span>
<span class="s1">            self.write(&#39;slideform.</span><span class="si">%s</span><span class="s1">_magtext.value = &#39; </span><span class="si">% s</span><span class="s1">lideshow_id +</span>
<span class="s1">                       &#39;magnification.toString();\n&#39;)</span>
<span class="s1">        }}</span>
<span class="s1">        that.resizeImage();</span>
<span class="s1">    }</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="n">html_box_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;tr&gt;</span>
<span class="s1">&lt;td style=&quot;padding: 20 20 20 20&quot;&gt;</span>
<span class="s1">&lt;img class=&quot;slideshow&quot; src=&quot;&quot; name=&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_image_display&quot;</span>
<span class="s1">    width=&quot;$width&quot; height=&quot;$height&quot;&gt;</span>
<span class="s1">&lt;/td&gt;</span>
<span class="s1">&lt;/tr&gt;</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="n">html_controls_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">${{</span>
<span class="s1">if mag_control or (delay is not None):</span>
<span class="s1">    self.write(&#39;&lt;tr&gt;&lt;td align=center&gt;\n&#39;)</span>
<span class="s1">    if mag_control:</span>
<span class="s1">        self.html_mag_template(vars())</span>
<span class="s1">        if delay is not None:</span>
<span class="s1">            self.write(&#39;&lt;br&gt;\n&#39;)</span>
<span class="s1">    if delay is not None:</span>
<span class="s1">        self.html_delay_template(vars())</span>
<span class="s1">    self.write(&#39;&lt;/td&gt;&lt;/tr&gt;\n&#39;)</span>
<span class="s1">}}</span>
<span class="s1">&#39;&#39;&#39;</span>

    <span class="n">html_mag_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">magnification: &lt;input type=&quot;text&quot; name=&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_magtext&quot;</span>
<span class="s1">    onChange=&quot;$slideshow_id.changeMag();&quot; value=&quot;0&quot; size=&quot;2&quot;&gt;</span>
<span class="s1">&lt;input type=button onClick=&quot;$slideshow_id.smaller();&quot; value=&quot;-&quot; title=&quot;Smaller&quot;&gt;</span>
<span class="s1">&lt;input type=button onClick=&quot;$slideshow_id.larger();&quot; value=&quot;+&quot; title=&quot;Larger&quot;&gt;</span>
<span class="s1">&#39;&#39;&#39;</span>


<span class="k">class</span> <span class="nc">SectionImageHTMLSlideShow</span><span class="p">(</span><span class="n">SectionHTMLSlideShow</span><span class="p">,</span> <span class="n">ImageHTMLSlideShow</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Image slideshow with section markers.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filenames</span><span class="p">,</span> <span class="n">section_ids</span><span class="p">,</span> <span class="n">image_size</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the HTML code for a sectioned slideshow of the given images.</span>

<span class="sd">        For keyword arguments see the super classes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">section_ids</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">):</span>
            <span class="n">err</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The number of section slideshow_id entries does not match &quot;</span>
                   <span class="s2">&quot;the number of slides / filenames.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">vars</span><span class="p">())</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;self&quot;</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SectionImageHTMLSlideShow</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">js_controls_resize_template</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    that.resizeImage = function () {</span>
<span class="s1">        document.images.$</span><span class="si">{slideshow_id}</span><span class="s1">_image_display.width =</span>
<span class="s1">            parseInt(magnification * original_width, 10);</span>
<span class="s1">        document.images.$</span><span class="si">{slideshow_id}</span><span class="s1">_image_display.height =</span>
<span class="s1">            parseInt(magnification * original_height, 10);</span>
<span class="s1">        // make sure that section ids are nicely line wrapped</span>
<span class="s1">        var section_panel_width = 250;</span>
<span class="s1">        if (magnification * original_height &gt; section_panel_width) {</span>
<span class="s1">            section_panel_width = magnification * original_width;</span>
<span class="s1">        }</span>
<span class="s1">        document.getElementById(&quot;$</span><span class="si">{slideshow_id}</span><span class="s1">_sections_panel&quot;).style.width =</span>
<span class="s1">            parseInt(section_panel_width, 10) + &quot;px&quot;;</span>
<span class="s1">    }</span>
<span class="s1">&#39;&#39;&#39;</span>


<span class="c1">### helper functions ###</span>

<span class="c1"># TODO: extract image size automatically,</span>
<span class="c1">#    but this introduces an optional dependency on PIL</span>

<span class="k">def</span> <span class="nf">image_slideshow</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span> <span class="n">image_size</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">section_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">delay</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">delay_delta</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">slideshow_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">magnification</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mag_control</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shortcuts</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a string with the JS and HTML code for an image slideshow.</span>

<span class="sd">    Note that the CSS code for the slideshow is not included, so you should</span>
<span class="sd">    add SLIDESHOW_STYLE or a custom style to your CSS code.</span>

<span class="sd">    filenames -- Sequence of the image filenames.</span>
<span class="sd">    image_size -- Tuple (x,y) with the original image size, or enter</span>
<span class="sd">        a different size to force scaling.</span>
<span class="sd">    title -- Optional slideshow title (for default None not title is shown).</span>
<span class="sd">    section_ids -- List with the section id for each slide index. The id</span>
<span class="sd">            can be a string or a number. Default value None disables the</span>
<span class="sd">            section feature.</span>

<span class="sd">    For additional keyword arguments see the ImageHTMLSlideShow class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">section_ids</span><span class="p">:</span>
        <span class="n">slideshow</span> <span class="o">=</span> <span class="n">SectionImageHTMLSlideShow</span><span class="p">(</span><span class="o">**</span><span class="nb">vars</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">slideshow</span> <span class="o">=</span> <span class="n">ImageHTMLSlideShow</span><span class="p">(</span><span class="o">**</span><span class="nb">vars</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">slideshow</span><span class="p">)</span>

<div class="viewcode-block" id="show_image_slideshow"><a class="viewcode-back" href="../../../mdp/mdp.utils.slideshow.html#mdp.utils.show_image_slideshow">[docs]</a><span class="k">def</span> <span class="nf">show_image_slideshow</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span> <span class="n">image_size</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">section_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">delay_delta</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                         <span class="n">loop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">slideshow_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">magnification</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mag_control</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">open_browser</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write the slideshow into a HTML file, open it in the browser and</span>
<span class="sd">    return a file object pointing to the file. If the filename is not given,</span>
<span class="sd">    a temporary file is used, and will be deleted when the returned file object</span>
<span class="sd">    is closed or destroyed.</span>

<span class="sd">    filenames -- Sequence of the image filenames.</span>
<span class="sd">    image_size -- Tuple (x,y) with the original image size, or enter</span>
<span class="sd">        a different size to force scaling.</span>
<span class="sd">    filename -- Filename for the HTML file to be created. If None</span>
<span class="sd">            a temporary file is created.</span>
<span class="sd">    title -- Optional slideshow title (for default None not title is shown).</span>
<span class="sd">    section_ids -- List with the section id for each slide index. The id</span>
<span class="sd">            can be a string or a number. Default value None disables the</span>
<span class="sd">            section feature.</span>
<span class="sd">    open_browser -- If True (default value) then the slideshow file is</span>
<span class="sd">        automatically opened in a webbrowser. One can also use string value</span>
<span class="sd">        with the browser name (for webbrowser.get) to request a specific</span>
<span class="sd">        browser.</span>

<span class="sd">    For additional keyword arguments see the ImageHTMLSlideShow class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">html_file</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;MDP_&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">html_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">html_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;html&gt;</span><span class="se">\n</span><span class="s1">&lt;head&gt;</span><span class="se">\n</span><span class="s1">&lt;title&gt;</span><span class="si">%s</span><span class="s1">&lt;/title&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">title</span><span class="p">)</span>
    <span class="n">html_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;style type=&quot;text/css&quot; media=&quot;screen&quot;&gt;&#39;</span><span class="p">)</span>
    <span class="n">html_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">basic_css</span><span class="p">()</span> <span class="o">+</span> <span class="n">image_slideshow_css</span><span class="p">())</span>
    <span class="n">html_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;/style&gt;</span><span class="se">\n</span><span class="s1">&lt;/head&gt;</span><span class="se">\n</span><span class="s1">&lt;body&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">()</span>
    <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;open_browser&#39;</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;html_file&#39;</span><span class="p">]</span>
    <span class="n">html_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">image_slideshow</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="n">html_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;/body&gt;</span><span class="se">\n</span><span class="s1">&lt;/html&gt;&#39;</span><span class="p">)</span>
    <span class="n">html_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">open_browser</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">open_browser</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">custom_browser</span> <span class="o">=</span> <span class="n">webbrowser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">open_browser</span><span class="p">)</span>
                <span class="n">custom_browser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">webbrowser</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
                <span class="n">err</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Could not open browser &#39;</span><span class="si">%s</span><span class="s2">&#39;, using default.&quot;</span> <span class="o">%</span>
                       <span class="n">open_browser</span><span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">html_file</span></div>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
      Last updated on 2020-02-17 1:33:02 PM Coordinated Universal Time.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'3.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/language_data.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   
<div class="footer">
    <hr />
    <table>
      <tr>
        <td class="footer-left">
           <a href="http://sourceforge.net/projects/mdp-toolkit">
 <img src="http://sflogo.sourceforge.net/sflogo.php?group_id=116959&amp;type=12"
      width="120" height="30" border="0" alt="MDP@SF.NET"/> </a>
        </td>
        <td class="footer-center">
          Last updated on
             2020-02-17 1:33:02 PM Coordinated Universal Time
        </td>
        <td class="footer-right">
         <form class="search" action="../../../search.html" method="get">
          <input type="submit" value="Search" />
          <input type="text" name="q" size="18" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
         </form>
        </td>
    </table>  
    <!-- Piwik -->
    <script type="text/javascript">
	var pkBaseURL = (("https:" == document.location.protocol) ? "https://sourceforge.net/apps/piwik/mdp-toolkit/" : "http://sourceforge.net/apps/piwik/mdp-toolkit/");
	document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
	piwik_action_name = '';
	piwik_idsite = 1;
	piwik_url = pkBaseURL + "piwik.php";
	piwik_log(piwik_action_name, piwik_idsite, piwik_url);
    </script>
    <object><noscript>
	    <p>
		<img src="http://sourceforge.net/apps/piwik/mdp-toolkit/piwik.php?idsite=1"
		     alt="piwik" />
	    </p>
    </noscript></object>
    <!-- End Piwik Tag -->
</div>   


</body>
</html>